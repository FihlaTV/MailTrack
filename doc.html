<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Seguimiento - Web oficial del proyecto</title>
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/extra.css" rel="stylesheet">
    <link rel="shortcut icon" type="image/x-icon" href="img/favicon.ico" />
    </head>

    <body style="padding-top:40px;" data-spy="scroll" data-target=".bs-docs-sidebar" offset="10">

<div class="navbar navbar-fixed-top navbarinverse">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="index.html"><img src="img/logo_mini.png" style="margin-top:-5px;"/></a>
          <div class="nav-collapse collapse">
            <ul class="nav">
            </ul>
 		<ul class="nav pull-right">
              <li ><a href="index.html"><i class="icon-home"></i> Inicio</a></li>
              <li class="active"><a href="doc.html">Documentación</a></li>                     
          </div><!--/.nav-collapse -->

        </div>
      </div>
    </div>


<div class="container">

    <!-- Docs nav
    ================================================== -->
    <div class="row">
      <div class="span3 bs-docs-sidebar bs-docs-sidenav affix">
		<div class="mywell">
              <ul class="nav nav-list">
                <li class="nav-header">Instalación</li>
     								<li><a href="#req">Prerrequisitos</a></li>
      								<li><a href="#down">Descargando Seguimiento</a></li>
      								<li><a href="#vars">Variables y nomenclatura</a></li>
       								<li><a href="#createdatabase">Creación de la base de datos</a></li>
                <li class="divider"></li>        
                <li class="nav-header">Configuración</li>
     								<li><a href="#general">General</a></li>
      								<li><a href="#database">Base de datos</a></li>
       								<li><a href="#logs">Logs y scripts</a></li>
								<li><a href="#ssh">Ssh</a></li>
       								<li><a href="#crontab">Crontab</a></li>
                <li class="divider"></li>   
                <li class="nav-header">Otros</li>
  								<li><a href="#script">Scripts personalizados</a></li>
  								<li><a href="#support">Soporte</a></li>
     								<li><a href="#1.0.0">Release notes</a></li>
              </ul>
            </div> <!-- /well -->
    </div>
      
      
      <div class="span9 offset3">

     	 <section id="install"><br/>   

	<img src="img/logo.png"/><br/><br/>   
		  <h2>Instalación </h2>
		    <section id="req"><br/>
			<h3>Prerrequisitos</h3>

<p>Seguimiento necesita una máquina con sistema operativo <b>GNU/Linux</b> para funcionar. Las especificaciones ténicas de la máquina (CPU, GB de memoria RAM, GB de disco duro, etc., dependerán del volumen de correo que se registre en la institución/organismo donde se esté instalando la aplicación).</p>

<p>Software necesario en la máquina (versiones mínimas):</p>
<pre>
<ul>
	<li>PHP v5.1.6</li>
	<li>MySQL v5.0.77</li>
	<li>Paquetes necesarios para comunicar PHP con MySQL</li>
	<li>Servidor web para php (por ejemplo Apache)</li>
	<li>PERL v5.8.8</li>
	<li>Módulos de Perl: 
		<li>- Encode</li>
		<li>- Time::Local qw(timelocal)</li>
		<li>- POSIX qw(strftime);</li>
		<li>- MIME::Words qw(:all)</li>
		<li>- Time::TAI64 qw/tai2unix/</li>
		<li>- DBI</li>
	</li>
</ul>
</pre>
		    <section id="down"><br/>
			<h3>Descargando Seguimiento</h3>

<p>Seguimiento puede descargarse de dos formas:</p>
<br/>
<p><b>1)</b> Descargando directamente la <b>versión empaquetada en tar.gz</b> de la última release estable:</b></p>
<pre><i class="icon-download-alt"></i> <a href="http://github.com/vtellez/seguimiento/tarball/master">Descargar tar.gz</a></pre>
<br/>
<p><b>2)</b> Utilizando el <b>sistema de versiones (git)</b> del proyecto en github:</b></p>
<pre>git://github.com/vtellez/seguimiento.git</pre>

<p>ó</p>

<pre>https://github.com/vtellez/seguimiento.git</pre>


		    <section id="vars"><br/>
			<h3>Variables y nomenclatura</h3>
		<p>En adelante, usaremos los siguientes términos y variables en esta página de documentación:</p>
		
		<pre>
		<ul>
		<li><b>$PATH_A_SEGUIMIENTO</b>: Esta variable hace referencia a la ruta donde se ha desplegado la instalación. <br/>Por ejemplo, la ruta podría ser <code>/var/www/Seguimiento</code></li>
		</ul>
		</pre>

		    <section id="createdatabase"><br/>
			<h3>Creación de la base de datos</h3>
			
			<p>Creación del usuario en MySQL para Seguimiento de mensajes</p>
<pre>
 # mysql -uroot -p<br/>
 Enter password: (el de root)
 </pre>
 <pre>
 mysql> GRANT ALL PRIVILEGES ON seguimiento.* TO seguimiento@localhost
        IDENTIFIED BY 'password-de-seguimiento';
 </pre>
 <pre>
 mysql> CREATE DATABASE seguimiento;
 </pre>
 <pre>
 mysql> FLUSH PRIVILEGES;
 </pre>

<p>Creación de las tablas de Seguimiento de mensajes</p>
<pre>
 # mysql -useguimiento -p seguimiento < $PATH_A_SEGUIMIENTO/mysql-database/schema.sql
 </pre>
			


	     	<section id="config"><br/>		
			<h2>Configuración</h2>
<p>Para la puesta en marcha de aplicación se deberán modificar ciertos ficheros de configuración.</p>
		    <section id="general"><br/>	
			<h3>Configuración general (config.php)</h3>

<p>$PATH_A_SEGUIMIENTO/app/config/config.php.plantilla: Debe eliminarse de la extensión el sufijo ".plantilla". Configurar este fichero para definir la dirección base de la aplicación, la lista de administradores, número de mensajes por página, etc etc. Crear directorio de logs de acuerdo a lo configurado en este fichero.</p>

		    <section id="database"><br/>	
			<h3>Configuación de la base de datos (database.php)</h3>

<p>$PATH_A_SEGUIMIENTO/app/config/database.php.plantilla: Debe eliminarse de la extensión el sufijo ".plantilla". Este fichero incluye la información relativa a la base de datos de la aplicación así como al usuario para ésta, para permitir así la conexión desde php.</p>

		    <section id="logs"><br/>	
			<h3>Configuración de logs y scripts (config.pl)</h3>

<p>$PATH_A_SEGUIMIENTO/scripts/etc/config.pl.plantilla: Debe eliminarse de la extensión el sufijo ".plantilla". Este fichero incluye información acerca del proceso de parseado de los logs: Definición del dominio principal de la institución, tiempo de vida (en días) de los mensajes en la base de datos, configuración de datos para la conexión con la base de datos desde perl, etc.</p>

<p>$PATH_A_SEGUIMIENTO/scripts/etc/hosts.plantilla: Debe eliminarse de la extensión el sufijo ".plantilla". En este fichero debe incluirse la información de los logs que se quiera procesar. En el propio fichero esta incluido un ejemplo para comprender la sintaxis que se utiliza en el.</p>

<p>$PATH_A_SEGUIMIENTO/scripts/bin/actualiza.sh: En este fichero tan solo debe editarse la primera línea no comentada, que hace referencia a la ruta donde se encuentra alojado el directorio "scripts".</p>


		    <section id="ssh"><br/>	
			<h3>Configuración ssh</h3>
<p>Seguimiento de mensajes obtiene los logs de las máquinas de forma remota utilizando un protocolo de transmisión de ficheros segura basado en el protocolo ssh (comando scp).</p>

<p>Es por ello que para que el script principal funcione correctamente, debemos dar permiso a las máquinas remotas para que seguimiento obtenga los logs sin necesidad de establecer un usuario y contraseña. Para ello, se utiliza los certificados de clave pública de la propia máquina.</p>

<p>Deberemos copiar la clave pública de la máquina que procesará los logs (alojada generalmente en $HOME/.ssh/id_rsa.pub) en la lista de servidores autorizados en las máquinas remotas (definidas normalmente en el archivo $HOME/.ssh/authorized_keys)</p>

		    <section id="crontab"><br/>	
			<h3>Configuración crontab</h3>

<p>Seguimiento de mensajes, requiere que se añadan varias entradas en la lista de tareas automáticas del sistema:</p>
<pre>
#SEGUIMIENTO: Ejecución del script que recorre los logs de correo y los guarda en la base de datos<br/>
*/10 0-4,6-23 * * * bash $PATH_A_SEGUIMIENTO/scripts/bin/actualiza.sh hosts > /tmp/salida<br/>
<br/>
#SEGUIMIENTO: Cada dia borramos los mensajes y accesos más antiguos la base de datos<br/>
1 5 * * * bash $PATH_A_SEGUIMIENTO/scripts/bin/borrado_bbdd.sh<br/>
<br/>
#SEGUIMIENTO: Calculo de indicadores por horas/días/meses<br/>
7 0 * * * perl $PATH_A_SEGUIMIENTO/scripts/bin/indicadores.pl<br/>
</pre>

<p>La primera de ellas hace referencia a la frecuencia con la que se quiere que se lean los logs de las distintas máquinas. Dicho de otra forma, con que margen de tiempo con respecto al tiempo real, queremos que se actualicen los datos en la base de datos. En este ejemplo, la frecuencia de parseo sería cada 10 minutos.</p>

<p>La segunda entrada, debe ejecutarse una vez al día, y será la encargada de eliminar aquellos mensajes con más de X días (configurado en /scripts/etc/config.pl) de antigüedad.</p>

<p>La última entrada se ejecuta una vez al día y se encarga de calcular los datos necesarios para los indicadores diarios de la aplicación.</p>





<section id="adapt"><br/>		
<h2>Adaptaciones</h2>

<section id="scritp"><br/>	
<h3>Scripts personalizados</h3>

<p>Se debe tener en cuenta que los módulos de perl para el procesado de logs realizados (accesibles en scripts/bin/) están realizados para el formato de log implementado en la Universidad de Sevilla y que dicho formato puede cambiar de una institución a otra incluso utilizando el mismo software.
Es por este motivo, que muy posiblemente, para su puesta en marcha, se requiera una confirmación de la validez y/o posible modificación del código para adptarlo al formato de log del que se dispone.</p>





<section id="support"><br/>		
<h2>Soporte</h2>

<section id="comunity"><br/>	
<h3>Comunidad</h3>


<section id="personalsupport"><br/>	
<h3>Soporte personalizado</h3>




<section id="release"><br/>		
<h2>Release notes</h2>

<section id="1.0.0"><br/>	
<h3>1.0.0</h3>


	</div>
	</div>



<!--  Footer
      ================================================== --><br/><br/><br/>
      <footer class="footer" style="border-top: 1px solid #ccc"><br/>
              <p class="pull-right"><a href="#">Volver arriba</a></p>
        <p>El código fuente de Seguimiento sigue la <a href="http://www.gnu.org/licenses/agpl-3.0.html" target="_blank">licencia pública general de Affero</a>.</p>
        <p>Página diseñada por <a href="http://vtellez.es" target="_blank">Víctor Téllez</a>, utilizando <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter bootstrap</a>.</p>
      </footer>


    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    
     <!-- Add jQuery library -->
	<script type="text/javascript" src="js/fancy/lib/jquery-1.8.0.min.js"></script>

	<!-- Add fancyBox main JS and CSS files -->
	<script type="text/javascript" src="js/fancy/source/jquery.fancybox.js?v=2.1.0"></script>
	<link rel="stylesheet" type="text/css" href="js/fancy/source/jquery.fancybox.css?v=2.1.0" media="screen" />

	<script type="text/javascript">
		$(document).ready(function() {
			/*
			 *  Simple image gallery. Uses default settings
			 */

			$('.fancybox').fancybox();

		});
	</script>
     
   
    <script src="js/bootstrap.js"></script>

    </body>
    </html>
